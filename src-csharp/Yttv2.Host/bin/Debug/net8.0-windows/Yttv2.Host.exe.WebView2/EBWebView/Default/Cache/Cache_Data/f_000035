import { createHotContext as __vite__createHotContext } from "/@vite/client";import.meta.hot = __vite__createHotContext("/src/components/CardMenu.jsx");import __vite__cjsImport0_react_jsxDevRuntime from "/node_modules/.vite/deps/react_jsx-dev-runtime.js?v=cd56faf3"; const jsxDEV = __vite__cjsImport0_react_jsxDevRuntime["jsxDEV"];
import * as RefreshRuntime from "/@react-refresh";
const inWebWorker = typeof WorkerGlobalScope !== "undefined" && self instanceof WorkerGlobalScope;
let prevRefreshReg;
let prevRefreshSig;
if (import.meta.hot && !inWebWorker) {
  if (!window.$RefreshReg$) {
    throw new Error(
      "@vitejs/plugin-react can't detect preamble. Something is wrong."
    );
  }
  prevRefreshReg = window.$RefreshReg$;
  prevRefreshSig = window.$RefreshSig$;
  window.$RefreshReg$ = RefreshRuntime.getRefreshReg("C:/Projects/yttv2/src/components/CardMenu.jsx");
  window.$RefreshSig$ = RefreshRuntime.createSignatureFunctionForTransform;
}
var _s = $RefreshSig$(), _s2 = $RefreshSig$();
import __vite__cjsImport3_react from "/node_modules/.vite/deps/react.js?v=cd56faf3"; const React = __vite__cjsImport3_react.__esModule ? __vite__cjsImport3_react.default : __vite__cjsImport3_react; const useState = __vite__cjsImport3_react["useState"]; const useRef = __vite__cjsImport3_react["useRef"]; const useEffect = __vite__cjsImport3_react["useEffect"];
import __vite__cjsImport4_reactDom from "/node_modules/.vite/deps/react-dom.js?v=cd56faf3"; const ReactDOM = __vite__cjsImport4_reactDom.__esModule ? __vite__cjsImport4_reactDom.default : __vite__cjsImport4_reactDom;
import { useLayoutStore } from "/src/store/layoutStore.js";
const CardMenu = ({ options, onOptionClick, submenuOptions = {} }) => {
  _s();
  const [isOpen, setIsOpen] = useState(false);
  const [activeSubmenu, setActiveSubmenu] = useState(null);
  const menuRef = useRef(null);
  const buttonRef = useRef(null);
  const containerRef = useRef(null);
  const { inspectMode } = useLayoutStore();
  const getInspectTitle = (label) => inspectMode ? label : void 0;
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (containerRef.current && !containerRef.current.contains(event.target)) {
        setIsOpen(false);
      }
    };
    if (isOpen) {
      setTimeout(() => {
        document.addEventListener("mousedown", handleClickOutside);
      }, 0);
    }
    return () => {
      document.removeEventListener("mousedown", handleClickOutside);
    };
  }, [isOpen]);
  const handleOptionClick = (option) => {
    if (option.submenu && submenuOptions[option.submenu]) {
      setActiveSubmenu(option.submenu);
      return;
    }
    if (onOptionClick) {
      onOptionClick(option);
    }
    setIsOpen(false);
    setActiveSubmenu(null);
  };
  const handleSubmenuOptionClick = (submenuKey, submenuOption) => {
    if (onOptionClick) {
      onOptionClick({ ...submenuOption, parentAction: submenuKey });
    }
    setIsOpen(false);
    setActiveSubmenu(null);
  };
  return /* @__PURE__ */ jsxDEV("div", { ref: containerRef, className: "relative", "data-card-menu": "true", children: [
    /* @__PURE__ */ jsxDEV(
      "button",
      {
        ref: buttonRef,
        onClick: (e) => {
          e.stopPropagation();
          setIsOpen(!isOpen);
        },
        className: "p-1.5 rounded-lg hover:bg-slate-700/50 transition-colors text-slate-400 hover:text-white",
        title: getInspectTitle("More options") || "More options",
        children: /* @__PURE__ */ jsxDEV(
          "svg",
          {
            className: "w-5 h-5",
            fill: "currentColor",
            viewBox: "0 0 20 20",
            children: /* @__PURE__ */ jsxDEV("path", { d: "M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" }, void 0, false, {
              fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
              lineNumber: 96,
              columnNumber: 11
            }, this)
          },
          void 0,
          false,
          {
            fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
            lineNumber: 91,
            columnNumber: 9
          },
          this
        )
      },
      void 0,
      false,
      {
        fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
        lineNumber: 82,
        columnNumber: 7
      },
      this
    ),
    isOpen && /* @__PURE__ */ jsxDEV(
      PortalDropdown,
      {
        isOpen,
        buttonRef,
        menuRef,
        onClose: () => setIsOpen(false),
        options,
        handleOptionClick,
        submenuOptions,
        activeSubmenu,
        setActiveSubmenu,
        handleSubmenuOptionClick
      },
      void 0,
      false,
      {
        fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
        lineNumber: 102,
        columnNumber: 7
      },
      this
    )
  ] }, void 0, true, {
    fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
    lineNumber: 80,
    columnNumber: 5
  }, this);
};
_s(CardMenu, "aaSux0SiU4L+co8xlWFB0L2vVZ8=", false, function() {
  return [useLayoutStore];
});
_c = CardMenu;
const PortalDropdown = ({
  buttonRef,
  menuRef,
  onClose,
  options,
  handleOptionClick,
  submenuOptions,
  activeSubmenu,
  setActiveSubmenu,
  handleSubmenuOptionClick
}) => {
  _s2();
  const [position, setPosition] = useState(null);
  const portalRef = useRef(null);
  useEffect(() => {
    const updatePosition = () => {
      if (buttonRef.current) {
        const rect = buttonRef.current.getBoundingClientRect();
        let top = rect.bottom + 5;
        let left = rect.right - 192;
        if (left < 0) left = rect.left;
        setPosition({ top, left });
      }
    };
    updatePosition();
    window.addEventListener("resize", updatePosition);
    document.addEventListener("scroll", updatePosition, true);
    return () => {
      window.removeEventListener("resize", updatePosition);
      document.removeEventListener("scroll", updatePosition, true);
    };
  }, [buttonRef]);
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (menuRef.current && !menuRef.current.contains(event.target) && buttonRef.current && !buttonRef.current.contains(event.target)) {
        onClose();
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => {
      document.removeEventListener("mousedown", handleClickOutside);
    };
  }, [menuRef, buttonRef, onClose]);
  if (!position) return null;
  return ReactDOM.createPortal(
    /* @__PURE__ */ jsxDEV(
      "div",
      {
        ref: menuRef,
        className: "fixed z-30 bg-slate-800 border border-slate-700 rounded-lg shadow-xl overflow-visible w-48",
        style: {
          top: position.top,
          left: position.left,
          position: "fixed"
          // Viewport relative
        },
        onClick: (e) => e.stopPropagation(),
        children: [
          options.map(
            (option, index) => /* @__PURE__ */ jsxDEV(
              "button",
              {
                onClick: (e) => {
                  e.preventDefault();
                  e.stopPropagation();
                  if (!option.disabled) {
                    handleOptionClick(option);
                  }
                },
                disabled: option.disabled,
                className: `w-full text-left px-4 py-2.5 text-sm transition-colors relative ${option.disabled ? "opacity-50 cursor-not-allowed text-slate-500" : option.danger ? "text-red-400 hover:bg-red-500/10 hover:text-red-300" : "text-white hover:bg-slate-700"} ${index === 0 ? "" : "border-t border-slate-700"}`,
                children: /* @__PURE__ */ jsxDEV("div", { className: "flex items-center justify-between gap-3", children: [
                  /* @__PURE__ */ jsxDEV("div", { className: "flex items-center gap-3", children: [
                    option.icon && /* @__PURE__ */ jsxDEV("span", { className: "flex-shrink-0", children: option.icon }, void 0, false, {
                      fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                      lineNumber: 218,
                      columnNumber: 13
                    }, this),
                    /* @__PURE__ */ jsxDEV("span", { children: option.label }, void 0, false, {
                      fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                      lineNumber: 220,
                      columnNumber: 15
                    }, this)
                  ] }, void 0, true, {
                    fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                    lineNumber: 216,
                    columnNumber: 13
                  }, this),
                  option.submenu && /* @__PURE__ */ jsxDEV("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: /* @__PURE__ */ jsxDEV("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M9 5l7 7-7 7" }, void 0, false, {
                    fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                    lineNumber: 224,
                    columnNumber: 17
                  }, this) }, void 0, false, {
                    fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                    lineNumber: 223,
                    columnNumber: 11
                  }, this)
                ] }, void 0, true, {
                  fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                  lineNumber: 215,
                  columnNumber: 11
                }, this)
              },
              index,
              false,
              {
                fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                lineNumber: 198,
                columnNumber: 7
              },
              this
            )
          ),
          activeSubmenu && submenuOptions[activeSubmenu] && /* @__PURE__ */ jsxDEV(
            "div",
            {
              className: "absolute inset-0 bg-slate-800 z-10 flex flex-col animate-in slide-in-from-right duration-200",
              children: [
                /* @__PURE__ */ jsxDEV(
                  "button",
                  {
                    onClick: () => setActiveSubmenu(null),
                    className: "w-full text-left px-4 py-2.5 text-sm text-slate-400 hover:bg-slate-700 border-b border-slate-700 flex-shrink-0",
                    children: /* @__PURE__ */ jsxDEV("div", { className: "flex items-center gap-3", children: [
                      /* @__PURE__ */ jsxDEV("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: /* @__PURE__ */ jsxDEV("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M15 19l-7-7 7-7" }, void 0, false, {
                        fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                        lineNumber: 242,
                        columnNumber: 17
                      }, this) }, void 0, false, {
                        fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                        lineNumber: 241,
                        columnNumber: 15
                      }, this),
                      /* @__PURE__ */ jsxDEV("span", { children: "Back" }, void 0, false, {
                        fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                        lineNumber: 244,
                        columnNumber: 15
                      }, this)
                    ] }, void 0, true, {
                      fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                      lineNumber: 240,
                      columnNumber: 13
                    }, this)
                  },
                  void 0,
                  false,
                  {
                    fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                    lineNumber: 236,
                    columnNumber: 11
                  },
                  this
                ),
                /* @__PURE__ */ jsxDEV("div", { className: "flex-1 overflow-y-auto", children: submenuOptions[activeSubmenu].map(
                  (submenuOption, index) => /* @__PURE__ */ jsxDEV(
                    "button",
                    {
                      onClick: (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        if (!submenuOption.disabled) {
                          handleSubmenuOptionClick(activeSubmenu, submenuOption);
                        }
                      },
                      disabled: submenuOption.disabled,
                      className: `w-full text-left px-4 py-2.5 text-sm transition-colors ${submenuOption.disabled ? "opacity-50 cursor-not-allowed text-slate-500" : submenuOption.danger ? "text-red-400 hover:bg-red-500/10 hover:text-red-300" : "text-white hover:bg-slate-700"} ${index === 0 ? "" : "border-t border-slate-700"}`,
                      children: /* @__PURE__ */ jsxDEV("div", { className: "flex items-center gap-3", children: [
                        submenuOption.icon && /* @__PURE__ */ jsxDEV("span", { className: "flex-shrink-0", children: submenuOption.icon }, void 0, false, {
                          fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                          lineNumber: 268,
                          columnNumber: 15
                        }, this),
                        /* @__PURE__ */ jsxDEV("span", { children: submenuOption.label }, void 0, false, {
                          fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                          lineNumber: 270,
                          columnNumber: 19
                        }, this)
                      ] }, void 0, true, {
                        fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                        lineNumber: 266,
                        columnNumber: 17
                      }, this)
                    },
                    index,
                    false,
                    {
                      fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                      lineNumber: 249,
                      columnNumber: 11
                    },
                    this
                  )
                ) }, void 0, false, {
                  fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
                  lineNumber: 247,
                  columnNumber: 11
                }, this)
              ]
            },
            void 0,
            true,
            {
              fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
              lineNumber: 233,
              columnNumber: 7
            },
            this
          )
        ]
      },
      void 0,
      true,
      {
        fileName: "C:/Projects/yttv2/src/components/CardMenu.jsx",
        lineNumber: 187,
        columnNumber: 5
      },
      this
    ),
    document.body
  );
};
_s2(PortalDropdown, "HcUVqnejfiXDLyLc4c33Pum3Nmw=");
_c2 = PortalDropdown;
export default CardMenu;
var _c, _c2;
$RefreshReg$(_c, "CardMenu");
$RefreshReg$(_c2, "PortalDropdown");
if (import.meta.hot && !inWebWorker) {
  window.$RefreshReg$ = prevRefreshReg;
  window.$RefreshSig$ = prevRefreshSig;
}
if (import.meta.hot && !inWebWorker) {
  RefreshRuntime.__hmr_import(import.meta.url).then((currentExports) => {
    RefreshRuntime.registerExportsForReactRefresh("C:/Projects/yttv2/src/components/CardMenu.jsx", currentExports);
    import.meta.hot.accept((nextExports) => {
      if (!nextExports) return;
      const invalidateMessage = RefreshRuntime.validateRefreshBoundaryAndEnqueueUpdate("C:/Projects/yttv2/src/components/CardMenu.jsx", currentExports, nextExports);
      if (invalidateMessage) import.meta.hot.invalidate(invalidateMessage);
    });
  });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6IkFBNEVVOzs7Ozs7Ozs7Ozs7Ozs7OztBQTVFVixPQUFPQSxTQUFTQyxVQUFVQyxRQUFRQyxpQkFBaUI7QUFDbkQsT0FBT0MsY0FBYztBQUNyQixTQUFTQyxzQkFBc0I7QUFFL0IsTUFBTUMsV0FBV0EsQ0FBQyxFQUFFQyxTQUFTQyxlQUFlQyxpQkFBaUIsQ0FBQyxFQUFFLE1BQU07QUFBQUMsS0FBQTtBQUNwRSxRQUFNLENBQUNDLFFBQVFDLFNBQVMsSUFBSVgsU0FBUyxLQUFLO0FBQzFDLFFBQU0sQ0FBQ1ksZUFBZUMsZ0JBQWdCLElBQUliLFNBQVMsSUFBSTtBQUN2RCxRQUFNYyxVQUFVYixPQUFPLElBQUk7QUFDM0IsUUFBTWMsWUFBWWQsT0FBTyxJQUFJO0FBQzdCLFFBQU1lLGVBQWVmLE9BQU8sSUFBSTtBQUNoQyxRQUFNLEVBQUVnQixZQUFZLElBQUliLGVBQWU7QUFHdkMsUUFBTWMsa0JBQWtCQSxDQUFDQyxVQUFVRixjQUFjRSxRQUFRQztBQUV6RGxCLFlBQVUsTUFBTTtBQUNkLFVBQU1tQixxQkFBcUJBLENBQUNDLFVBQVU7QUFDcEMsVUFDRU4sYUFBYU8sV0FDYixDQUFDUCxhQUFhTyxRQUFRQyxTQUFTRixNQUFNRyxNQUFNLEdBQzNDO0FBQ0FkLGtCQUFVLEtBQUs7QUFBQSxNQUNqQjtBQUFBLElBQ0Y7QUFFQSxRQUFJRCxRQUFRO0FBRVZnQixpQkFBVyxNQUFNO0FBQ2ZDLGlCQUFTQyxpQkFBaUIsYUFBYVAsa0JBQWtCO0FBQUEsTUFDM0QsR0FBRyxDQUFDO0FBQUEsSUFDTjtBQUVBLFdBQU8sTUFBTTtBQUNYTSxlQUFTRSxvQkFBb0IsYUFBYVIsa0JBQWtCO0FBQUEsSUFDOUQ7QUFBQSxFQUNGLEdBQUcsQ0FBQ1gsTUFBTSxDQUFDO0FBRVgsUUFBTW9CLG9CQUFvQkEsQ0FBQ0MsV0FBVztBQUVwQyxRQUFJQSxPQUFPQyxXQUFXeEIsZUFBZXVCLE9BQU9DLE9BQU8sR0FBRztBQUNwRG5CLHVCQUFpQmtCLE9BQU9DLE9BQU87QUFDL0I7QUFBQSxJQUNGO0FBRUEsUUFBSXpCLGVBQWU7QUFDakJBLG9CQUFjd0IsTUFBTTtBQUFBLElBQ3RCO0FBQ0FwQixjQUFVLEtBQUs7QUFDZkUscUJBQWlCLElBQUk7QUFBQSxFQUN2QjtBQUVBLFFBQU1vQiwyQkFBMkJBLENBQUNDLFlBQVlDLGtCQUFrQjtBQUM5RCxRQUFJNUIsZUFBZTtBQUNqQkEsb0JBQWMsRUFBRSxHQUFHNEIsZUFBZUMsY0FBY0YsV0FBVyxDQUFDO0FBQUEsSUFDOUQ7QUFDQXZCLGNBQVUsS0FBSztBQUNmRSxxQkFBaUIsSUFBSTtBQUFBLEVBQ3ZCO0FBRUEsU0FDRSx1QkFBQyxTQUFJLEtBQUtHLGNBQWMsV0FBVSxZQUFXLGtCQUFlLFFBRTFEO0FBQUE7QUFBQSxNQUFDO0FBQUE7QUFBQSxRQUNDLEtBQUtEO0FBQUFBLFFBQ0wsU0FBUyxDQUFDc0IsTUFBTTtBQUNkQSxZQUFFQyxnQkFBZ0I7QUFDbEIzQixvQkFBVSxDQUFDRCxNQUFNO0FBQUEsUUFDbkI7QUFBQSxRQUNBLFdBQVU7QUFBQSxRQUNWLE9BQU9RLGdCQUFnQixjQUFjLEtBQUs7QUFBQSxRQUUxQztBQUFBLFVBQUM7QUFBQTtBQUFBLFlBQ0MsV0FBVTtBQUFBLFlBQ1YsTUFBSztBQUFBLFlBQ0wsU0FBUTtBQUFBLFlBRVIsaUNBQUMsVUFBSyxHQUFFLGtHQUFSO0FBQUE7QUFBQTtBQUFBO0FBQUEsbUJBQXNHO0FBQUE7QUFBQSxVQUx4RztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsUUFNQTtBQUFBO0FBQUEsTUFmRjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFnQkE7QUFBQSxJQUdDUixVQUNDO0FBQUEsTUFBQztBQUFBO0FBQUEsUUFDQztBQUFBLFFBQ0E7QUFBQSxRQUNBO0FBQUEsUUFDQSxTQUFTLE1BQU1DLFVBQVUsS0FBSztBQUFBLFFBQzlCO0FBQUEsUUFDQTtBQUFBLFFBQ0E7QUFBQSxRQUNBO0FBQUEsUUFDQTtBQUFBLFFBQ0E7QUFBQTtBQUFBLE1BVkY7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLElBVXFEO0FBQUEsT0FoQ3pEO0FBQUE7QUFBQTtBQUFBO0FBQUEsU0FtQ0E7QUFFSjtBQUVBRixHQS9GTUosVUFBUTtBQUFBLFVBTVlELGNBQWM7QUFBQTtBQUFBbUMsS0FObENsQztBQWdHTixNQUFNbUMsaUJBQWlCQSxDQUFDO0FBQUEsRUFDdEJ6QjtBQUFBQSxFQUNBRDtBQUFBQSxFQUNBMkI7QUFBQUEsRUFDQW5DO0FBQUFBLEVBQ0F3QjtBQUFBQSxFQUNBdEI7QUFBQUEsRUFDQUk7QUFBQUEsRUFDQUM7QUFBQUEsRUFDQW9CO0FBQ0YsTUFBTTtBQUFBUyxNQUFBO0FBRUosUUFBTSxDQUFDQyxVQUFVQyxXQUFXLElBQUk1QyxTQUFTLElBQUk7QUFDN0MsUUFBTTZDLFlBQVk1QyxPQUFPLElBQUk7QUFHN0JDLFlBQVUsTUFBTTtBQUNkLFVBQU00QyxpQkFBaUJBLE1BQU07QUFDM0IsVUFBSS9CLFVBQVVRLFNBQVM7QUFDckIsY0FBTXdCLE9BQU9oQyxVQUFVUSxRQUFReUIsc0JBQXNCO0FBSXJELFlBQUlDLE1BQU1GLEtBQUtHLFNBQVM7QUFDeEIsWUFBSUMsT0FBT0osS0FBS0ssUUFBUTtBQUd4QixZQUFJRCxPQUFPLEVBQUdBLFFBQU9KLEtBQUtJO0FBRTFCUCxvQkFBWSxFQUFFSyxLQUFLRSxLQUFLLENBQUM7QUFBQSxNQUMzQjtBQUFBLElBQ0Y7QUFFQUwsbUJBQWU7QUFHZk8sV0FBT3pCLGlCQUFpQixVQUFVa0IsY0FBYztBQUNoRG5CLGFBQVNDLGlCQUFpQixVQUFVa0IsZ0JBQWdCLElBQUk7QUFFeEQsV0FBTyxNQUFNO0FBQ1hPLGFBQU94QixvQkFBb0IsVUFBVWlCLGNBQWM7QUFDbkRuQixlQUFTRSxvQkFBb0IsVUFBVWlCLGdCQUFnQixJQUFJO0FBQUEsSUFDN0Q7QUFBQSxFQUNGLEdBQUcsQ0FBQy9CLFNBQVMsQ0FBQztBQUdkYixZQUFVLE1BQU07QUFDZCxVQUFNbUIscUJBQXFCQSxDQUFDQyxVQUFVO0FBQ3BDLFVBQ0VSLFFBQVFTLFdBQVcsQ0FBQ1QsUUFBUVMsUUFBUUMsU0FBU0YsTUFBTUcsTUFBTSxLQUN6RFYsVUFBVVEsV0FBVyxDQUFDUixVQUFVUSxRQUFRQyxTQUFTRixNQUFNRyxNQUFNLEdBQzdEO0FBQ0FnQixnQkFBUTtBQUFBLE1BQ1Y7QUFBQSxJQUNGO0FBQ0FkLGFBQVNDLGlCQUFpQixhQUFhUCxrQkFBa0I7QUFFekQsV0FBTyxNQUFNO0FBQ1hNLGVBQVNFLG9CQUFvQixhQUFhUixrQkFBa0I7QUFBQSxJQUM5RDtBQUFBLEVBQ0YsR0FBRyxDQUFDUCxTQUFTQyxXQUFXMEIsT0FBTyxDQUFDO0FBR2hDLE1BQUksQ0FBQ0UsU0FBVSxRQUFPO0FBR3RCLFNBQU94QyxTQUFTbUQ7QUFBQUEsSUFDZDtBQUFBLE1BQUM7QUFBQTtBQUFBLFFBQ0MsS0FBS3hDO0FBQUFBLFFBQ0wsV0FBVTtBQUFBLFFBQ1YsT0FBTztBQUFBLFVBQ0xtQyxLQUFLTixTQUFTTTtBQUFBQSxVQUNkRSxNQUFNUixTQUFTUTtBQUFBQSxVQUNmUixVQUFVO0FBQUE7QUFBQSxRQUNaO0FBQUEsUUFDQSxTQUFTLENBQUNOLE1BQU1BLEVBQUVDLGdCQUFnQjtBQUFBLFFBRWpDaEM7QUFBQUEsa0JBQVFpRDtBQUFBQSxZQUFJLENBQUN4QixRQUFReUIsVUFDcEI7QUFBQSxjQUFDO0FBQUE7QUFBQSxnQkFFQyxTQUFTLENBQUNuQixNQUFNO0FBQ2RBLG9CQUFFb0IsZUFBZTtBQUNqQnBCLG9CQUFFQyxnQkFBZ0I7QUFDbEIsc0JBQUksQ0FBQ1AsT0FBTzJCLFVBQVU7QUFDcEI1QixzQ0FBa0JDLE1BQU07QUFBQSxrQkFDMUI7QUFBQSxnQkFDRjtBQUFBLGdCQUNBLFVBQVVBLE9BQU8yQjtBQUFBQSxnQkFDakIsV0FBVyxtRUFBbUUzQixPQUFPMkIsV0FDakYsaURBQ0EzQixPQUFPNEIsU0FDTCx3REFDQSwrQkFBK0IsSUFDL0JILFVBQVUsSUFBSSxLQUFLLDJCQUEyQjtBQUFBLGdCQUVwRCxpQ0FBQyxTQUFJLFdBQVUsMkNBQ2I7QUFBQSx5Q0FBQyxTQUFJLFdBQVUsMkJBQ1p6QjtBQUFBQSwyQkFBTzZCLFFBQ04sdUJBQUMsVUFBSyxXQUFVLGlCQUFpQjdCLGlCQUFPNkIsUUFBeEM7QUFBQTtBQUFBO0FBQUE7QUFBQSwyQkFBNkM7QUFBQSxvQkFFL0MsdUJBQUMsVUFBTTdCLGlCQUFPWixTQUFkO0FBQUE7QUFBQTtBQUFBO0FBQUEsMkJBQW9CO0FBQUEsdUJBSnRCO0FBQUE7QUFBQTtBQUFBO0FBQUEseUJBS0E7QUFBQSxrQkFDQ1ksT0FBT0MsV0FDTix1QkFBQyxTQUFJLFdBQVUsV0FBVSxNQUFLLFFBQU8sUUFBTyxnQkFBZSxTQUFRLGFBQ2pFLGlDQUFDLFVBQUssZUFBYyxTQUFRLGdCQUFlLFNBQVEsYUFBYSxHQUFHLEdBQUUsa0JBQXJFO0FBQUE7QUFBQTtBQUFBO0FBQUEseUJBQW1GLEtBRHJGO0FBQUE7QUFBQTtBQUFBO0FBQUEseUJBRUE7QUFBQSxxQkFWSjtBQUFBO0FBQUE7QUFBQTtBQUFBLHVCQVlBO0FBQUE7QUFBQSxjQTVCS3dCO0FBQUFBLGNBRFA7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxZQThCQTtBQUFBLFVBQ0Q7QUFBQSxVQUdBNUMsaUJBQWlCSixlQUFlSSxhQUFhLEtBQzVDO0FBQUEsWUFBQztBQUFBO0FBQUEsY0FDQyxXQUFVO0FBQUEsY0FFVjtBQUFBO0FBQUEsa0JBQUM7QUFBQTtBQUFBLG9CQUNDLFNBQVMsTUFBTUMsaUJBQWlCLElBQUk7QUFBQSxvQkFDcEMsV0FBVTtBQUFBLG9CQUVWLGlDQUFDLFNBQUksV0FBVSwyQkFDYjtBQUFBLDZDQUFDLFNBQUksV0FBVSxXQUFVLE1BQUssUUFBTyxRQUFPLGdCQUFlLFNBQVEsYUFDakUsaUNBQUMsVUFBSyxlQUFjLFNBQVEsZ0JBQWUsU0FBUSxhQUFhLEdBQUcsR0FBRSxxQkFBckU7QUFBQTtBQUFBO0FBQUE7QUFBQSw2QkFBc0YsS0FEeEY7QUFBQTtBQUFBO0FBQUE7QUFBQSw2QkFFQTtBQUFBLHNCQUNBLHVCQUFDLFVBQUssb0JBQU47QUFBQTtBQUFBO0FBQUE7QUFBQSw2QkFBVTtBQUFBLHlCQUpaO0FBQUE7QUFBQTtBQUFBO0FBQUEsMkJBS0E7QUFBQTtBQUFBLGtCQVRGO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxnQkFVQTtBQUFBLGdCQUNBLHVCQUFDLFNBQUksV0FBVSwwQkFDWkwseUJBQWVJLGFBQWEsRUFBRTJDO0FBQUFBLGtCQUFJLENBQUNwQixlQUFlcUIsVUFDakQ7QUFBQSxvQkFBQztBQUFBO0FBQUEsc0JBRUMsU0FBUyxDQUFDbkIsTUFBTTtBQUNkQSwwQkFBRW9CLGVBQWU7QUFDakJwQiwwQkFBRUMsZ0JBQWdCO0FBQ2xCLDRCQUFJLENBQUNILGNBQWN1QixVQUFVO0FBQzNCekIsbURBQXlCckIsZUFBZXVCLGFBQWE7QUFBQSx3QkFDdkQ7QUFBQSxzQkFDRjtBQUFBLHNCQUNBLFVBQVVBLGNBQWN1QjtBQUFBQSxzQkFDeEIsV0FBVywwREFBMER2QixjQUFjdUIsV0FDL0UsaURBQ0F2QixjQUFjd0IsU0FDWix3REFDQSwrQkFBK0IsSUFDL0JILFVBQVUsSUFBSSxLQUFLLDJCQUEyQjtBQUFBLHNCQUVwRCxpQ0FBQyxTQUFJLFdBQVUsMkJBQ1pyQjtBQUFBQSxzQ0FBY3lCLFFBQ2IsdUJBQUMsVUFBSyxXQUFVLGlCQUFpQnpCLHdCQUFjeUIsUUFBL0M7QUFBQTtBQUFBO0FBQUE7QUFBQSwrQkFBb0Q7QUFBQSx3QkFFdEQsdUJBQUMsVUFBTXpCLHdCQUFjaEIsU0FBckI7QUFBQTtBQUFBO0FBQUE7QUFBQSwrQkFBMkI7QUFBQSwyQkFKN0I7QUFBQTtBQUFBO0FBQUE7QUFBQSw2QkFLQTtBQUFBO0FBQUEsb0JBckJLcUM7QUFBQUEsb0JBRFA7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxrQkF1QkE7QUFBQSxnQkFDRCxLQTFCSDtBQUFBO0FBQUE7QUFBQTtBQUFBLHVCQTJCQTtBQUFBO0FBQUE7QUFBQSxZQXpDRjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsVUEwQ0E7QUFBQTtBQUFBO0FBQUEsTUF4Rko7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLElBMEZBO0FBQUEsSUFDQTdCLFNBQVNrQztBQUFBQSxFQUNYO0FBQ0Y7QUFBRW5CLElBaEtJRixnQkFBYztBQUFBc0IsTUFBZHRCO0FBa0tOLGVBQWVuQztBQUFTLElBQUFrQyxJQUFBdUI7QUFBQUMsYUFBQXhCLElBQUE7QUFBQXdCLGFBQUFELEtBQUEiLCJuYW1lcyI6WyJSZWFjdCIsInVzZVN0YXRlIiwidXNlUmVmIiwidXNlRWZmZWN0IiwiUmVhY3RET00iLCJ1c2VMYXlvdXRTdG9yZSIsIkNhcmRNZW51Iiwib3B0aW9ucyIsIm9uT3B0aW9uQ2xpY2siLCJzdWJtZW51T3B0aW9ucyIsIl9zIiwiaXNPcGVuIiwic2V0SXNPcGVuIiwiYWN0aXZlU3VibWVudSIsInNldEFjdGl2ZVN1Ym1lbnUiLCJtZW51UmVmIiwiYnV0dG9uUmVmIiwiY29udGFpbmVyUmVmIiwiaW5zcGVjdE1vZGUiLCJnZXRJbnNwZWN0VGl0bGUiLCJsYWJlbCIsInVuZGVmaW5lZCIsImhhbmRsZUNsaWNrT3V0c2lkZSIsImV2ZW50IiwiY3VycmVudCIsImNvbnRhaW5zIiwidGFyZ2V0Iiwic2V0VGltZW91dCIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJoYW5kbGVPcHRpb25DbGljayIsIm9wdGlvbiIsInN1Ym1lbnUiLCJoYW5kbGVTdWJtZW51T3B0aW9uQ2xpY2siLCJzdWJtZW51S2V5Iiwic3VibWVudU9wdGlvbiIsInBhcmVudEFjdGlvbiIsImUiLCJzdG9wUHJvcGFnYXRpb24iLCJfYyIsIlBvcnRhbERyb3Bkb3duIiwib25DbG9zZSIsIl9zMiIsInBvc2l0aW9uIiwic2V0UG9zaXRpb24iLCJwb3J0YWxSZWYiLCJ1cGRhdGVQb3NpdGlvbiIsInJlY3QiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJ0b3AiLCJib3R0b20iLCJsZWZ0IiwicmlnaHQiLCJ3aW5kb3ciLCJjcmVhdGVQb3J0YWwiLCJtYXAiLCJpbmRleCIsInByZXZlbnREZWZhdWx0IiwiZGlzYWJsZWQiLCJkYW5nZXIiLCJpY29uIiwiYm9keSIsIl9jMiIsIiRSZWZyZXNoUmVnJCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlcyI6WyJDYXJkTWVudS5qc3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZVN0YXRlLCB1c2VSZWYsIHVzZUVmZmVjdCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20nO1xuaW1wb3J0IHsgdXNlTGF5b3V0U3RvcmUgfSBmcm9tICcuLi9zdG9yZS9sYXlvdXRTdG9yZSc7XG5cbmNvbnN0IENhcmRNZW51ID0gKHsgb3B0aW9ucywgb25PcHRpb25DbGljaywgc3VibWVudU9wdGlvbnMgPSB7fSB9KSA9PiB7XG4gIGNvbnN0IFtpc09wZW4sIHNldElzT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFthY3RpdmVTdWJtZW51LCBzZXRBY3RpdmVTdWJtZW51XSA9IHVzZVN0YXRlKG51bGwpO1xuICBjb25zdCBtZW51UmVmID0gdXNlUmVmKG51bGwpO1xuICBjb25zdCBidXR0b25SZWYgPSB1c2VSZWYobnVsbCk7XG4gIGNvbnN0IGNvbnRhaW5lclJlZiA9IHVzZVJlZihudWxsKTtcbiAgY29uc3QgeyBpbnNwZWN0TW9kZSB9ID0gdXNlTGF5b3V0U3RvcmUoKTtcblxuICAvLyBIZWxwZXIgdG8gZ2V0IGluc3BlY3QgbGFiZWxcbiAgY29uc3QgZ2V0SW5zcGVjdFRpdGxlID0gKGxhYmVsKSA9PiBpbnNwZWN0TW9kZSA/IGxhYmVsIDogdW5kZWZpbmVkO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgaGFuZGxlQ2xpY2tPdXRzaWRlID0gKGV2ZW50KSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGNvbnRhaW5lclJlZi5jdXJyZW50ICYmXG4gICAgICAgICFjb250YWluZXJSZWYuY3VycmVudC5jb250YWlucyhldmVudC50YXJnZXQpXG4gICAgICApIHtcbiAgICAgICAgc2V0SXNPcGVuKGZhbHNlKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKGlzT3Blbikge1xuICAgICAgLy8gVXNlIGEgc21hbGwgZGVsYXkgdG8gYXZvaWQgaW1tZWRpYXRlIGNsb3NpbmdcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBoYW5kbGVDbGlja091dHNpZGUpO1xuICAgICAgfSwgMCk7XG4gICAgfVxuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGhhbmRsZUNsaWNrT3V0c2lkZSk7XG4gICAgfTtcbiAgfSwgW2lzT3Blbl0pO1xuXG4gIGNvbnN0IGhhbmRsZU9wdGlvbkNsaWNrID0gKG9wdGlvbikgPT4ge1xuICAgIC8vIENoZWNrIGlmIG9wdGlvbiBoYXMgc3VibWVudVxuICAgIGlmIChvcHRpb24uc3VibWVudSAmJiBzdWJtZW51T3B0aW9uc1tvcHRpb24uc3VibWVudV0pIHtcbiAgICAgIHNldEFjdGl2ZVN1Ym1lbnUob3B0aW9uLnN1Ym1lbnUpO1xuICAgICAgcmV0dXJuOyAvLyBEb24ndCBjbG9zZSBtZW51LCBzaG93IHN1Ym1lbnUgaW5zdGVhZFxuICAgIH1cblxuICAgIGlmIChvbk9wdGlvbkNsaWNrKSB7XG4gICAgICBvbk9wdGlvbkNsaWNrKG9wdGlvbik7XG4gICAgfVxuICAgIHNldElzT3BlbihmYWxzZSk7XG4gICAgc2V0QWN0aXZlU3VibWVudShudWxsKTtcbiAgfTtcblxuICBjb25zdCBoYW5kbGVTdWJtZW51T3B0aW9uQ2xpY2sgPSAoc3VibWVudUtleSwgc3VibWVudU9wdGlvbikgPT4ge1xuICAgIGlmIChvbk9wdGlvbkNsaWNrKSB7XG4gICAgICBvbk9wdGlvbkNsaWNrKHsgLi4uc3VibWVudU9wdGlvbiwgcGFyZW50QWN0aW9uOiBzdWJtZW51S2V5IH0pO1xuICAgIH1cbiAgICBzZXRJc09wZW4oZmFsc2UpO1xuICAgIHNldEFjdGl2ZVN1Ym1lbnUobnVsbCk7XG4gIH07XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2IHJlZj17Y29udGFpbmVyUmVmfSBjbGFzc05hbWU9XCJyZWxhdGl2ZVwiIGRhdGEtY2FyZC1tZW51PVwidHJ1ZVwiPlxuICAgICAgey8qIDMtZG90IG1lbnUgYnV0dG9uICovfVxuICAgICAgPGJ1dHRvblxuICAgICAgICByZWY9e2J1dHRvblJlZn1cbiAgICAgICAgb25DbGljaz17KGUpID0+IHtcbiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgIHNldElzT3BlbighaXNPcGVuKTtcbiAgICAgICAgfX1cbiAgICAgICAgY2xhc3NOYW1lPVwicC0xLjUgcm91bmRlZC1sZyBob3ZlcjpiZy1zbGF0ZS03MDAvNTAgdHJhbnNpdGlvbi1jb2xvcnMgdGV4dC1zbGF0ZS00MDAgaG92ZXI6dGV4dC13aGl0ZVwiXG4gICAgICAgIHRpdGxlPXtnZXRJbnNwZWN0VGl0bGUoJ01vcmUgb3B0aW9ucycpIHx8ICdNb3JlIG9wdGlvbnMnfVxuICAgICAgPlxuICAgICAgICA8c3ZnXG4gICAgICAgICAgY2xhc3NOYW1lPVwidy01IGgtNVwiXG4gICAgICAgICAgZmlsbD1cImN1cnJlbnRDb2xvclwiXG4gICAgICAgICAgdmlld0JveD1cIjAgMCAyMCAyMFwiXG4gICAgICAgID5cbiAgICAgICAgICA8cGF0aCBkPVwiTTEwIDZhMiAyIDAgMTEwLTQgMiAyIDAgMDEwIDR6TTEwIDEyYTIgMiAwIDExMC00IDIgMiAwIDAxMCA0ek0xMCAxOGEyIDIgMCAxMTAtNCAyIDIgMCAwMTAgNHpcIiAvPlxuICAgICAgICA8L3N2Zz5cbiAgICAgIDwvYnV0dG9uPlxuXG4gICAgICB7LyogRHJvcGRvd24gbWVudSAoUG9ydGFsKSAqL31cbiAgICAgIHtpc09wZW4gJiYgKFxuICAgICAgICA8UG9ydGFsRHJvcGRvd25cbiAgICAgICAgICBpc09wZW49e2lzT3Blbn1cbiAgICAgICAgICBidXR0b25SZWY9e2J1dHRvblJlZn1cbiAgICAgICAgICBtZW51UmVmPXttZW51UmVmfVxuICAgICAgICAgIG9uQ2xvc2U9eygpID0+IHNldElzT3BlbihmYWxzZSl9XG4gICAgICAgICAgb3B0aW9ucz17b3B0aW9uc31cbiAgICAgICAgICBoYW5kbGVPcHRpb25DbGljaz17aGFuZGxlT3B0aW9uQ2xpY2t9XG4gICAgICAgICAgc3VibWVudU9wdGlvbnM9e3N1Ym1lbnVPcHRpb25zfVxuICAgICAgICAgIGFjdGl2ZVN1Ym1lbnU9e2FjdGl2ZVN1Ym1lbnV9XG4gICAgICAgICAgc2V0QWN0aXZlU3VibWVudT17c2V0QWN0aXZlU3VibWVudX1cbiAgICAgICAgICBoYW5kbGVTdWJtZW51T3B0aW9uQ2xpY2s9e2hhbmRsZVN1Ym1lbnVPcHRpb25DbGlja31cbiAgICAgICAgLz5cbiAgICAgICl9XG4gICAgPC9kaXY+XG4gICk7XG59O1xuXG4vLyBQb3J0YWwgQ29tcG9uZW50IGZvciB0aGUgTWVudVxuY29uc3QgUG9ydGFsRHJvcGRvd24gPSAoe1xuICBidXR0b25SZWYsXG4gIG1lbnVSZWYsXG4gIG9uQ2xvc2UsXG4gIG9wdGlvbnMsXG4gIGhhbmRsZU9wdGlvbkNsaWNrLFxuICBzdWJtZW51T3B0aW9ucyxcbiAgYWN0aXZlU3VibWVudSxcbiAgc2V0QWN0aXZlU3VibWVudSxcbiAgaGFuZGxlU3VibWVudU9wdGlvbkNsaWNrXG59KSA9PiB7XG4gIC8vIEluaXQgdG8gbnVsbCBzbyB3ZSBkb24ndCByZW5kZXIgdW50aWwgY2FsY3VsYXRlZFxuICBjb25zdCBbcG9zaXRpb24sIHNldFBvc2l0aW9uXSA9IHVzZVN0YXRlKG51bGwpO1xuICBjb25zdCBwb3J0YWxSZWYgPSB1c2VSZWYobnVsbCk7XG5cbiAgLy8gQ2FsY3VsYXRlIHBvc2l0aW9uIG9uIG1vdW50LCByZXNpemUsIGFuZCBzY3JvbGxcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCB1cGRhdGVQb3NpdGlvbiA9ICgpID0+IHtcbiAgICAgIGlmIChidXR0b25SZWYuY3VycmVudCkge1xuICAgICAgICBjb25zdCByZWN0ID0gYnV0dG9uUmVmLmN1cnJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgICAgLy8gVXNlIEZpeGVkIHBvc2l0aW9uaW5nICh2aWV3cG9ydCByZWxhdGl2ZSlcbiAgICAgICAgLy8gVGhpcyB3b3JrcyBiZXN0IHdpdGggaW50ZXJuYWwgc2Nyb2xsIGNvbnRhaW5lcnMgYXMgd2UganVzdCB0cmFjayB0aGUgYnV0dG9uJ3MgdmlzdWFsIHBvc2l0aW9uXG4gICAgICAgIGxldCB0b3AgPSByZWN0LmJvdHRvbSArIDU7XG4gICAgICAgIGxldCBsZWZ0ID0gcmVjdC5yaWdodCAtIDE5MjsgLy8gMTkycHggaXMgdy00OFxuXG4gICAgICAgIC8vIEJvdW5kYXJ5IGNoZWNrXG4gICAgICAgIGlmIChsZWZ0IDwgMCkgbGVmdCA9IHJlY3QubGVmdDtcblxuICAgICAgICBzZXRQb3NpdGlvbih7IHRvcCwgbGVmdCB9KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdXBkYXRlUG9zaXRpb24oKTtcblxuICAgIC8vIExpc3RlbiB0byByZXNpemUgYW5kIFNDUk9MTCAoY2FwdHVyZSBwaGFzZSB0byBjYXRjaCBpbnRlcm5hbCBkaXYgc2Nyb2xscylcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdXBkYXRlUG9zaXRpb24pO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHVwZGF0ZVBvc2l0aW9uLCB0cnVlKTtcblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdXBkYXRlUG9zaXRpb24pO1xuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdXBkYXRlUG9zaXRpb24sIHRydWUpO1xuICAgIH07XG4gIH0sIFtidXR0b25SZWZdKTtcblxuICAvLyBDbGljayBvdXRzaWRlIHBvcnRhbFxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IGhhbmRsZUNsaWNrT3V0c2lkZSA9IChldmVudCkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBtZW51UmVmLmN1cnJlbnQgJiYgIW1lbnVSZWYuY3VycmVudC5jb250YWlucyhldmVudC50YXJnZXQpICYmXG4gICAgICAgIGJ1dHRvblJlZi5jdXJyZW50ICYmICFidXR0b25SZWYuY3VycmVudC5jb250YWlucyhldmVudC50YXJnZXQpXG4gICAgICApIHtcbiAgICAgICAgb25DbG9zZSgpO1xuICAgICAgfVxuICAgIH07XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgaGFuZGxlQ2xpY2tPdXRzaWRlKTtcblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBoYW5kbGVDbGlja091dHNpZGUpO1xuICAgIH07XG4gIH0sIFttZW51UmVmLCBidXR0b25SZWYsIG9uQ2xvc2VdKTtcblxuICAvLyBEb24ndCByZW5kZXIgdW50aWwgcG9zaXRpb24gaXMgY2FsY3VsYXRlZCB0byBhdm9pZCB0b3AtbGVmdCBmbGFzaFxuICBpZiAoIXBvc2l0aW9uKSByZXR1cm4gbnVsbDtcblxuICAvLyBVc2Ugc3RhbmRhcmQgUmVhY3RET00gcG9ydGFsXG4gIHJldHVybiBSZWFjdERPTS5jcmVhdGVQb3J0YWwoXG4gICAgPGRpdlxuICAgICAgcmVmPXttZW51UmVmfVxuICAgICAgY2xhc3NOYW1lPVwiZml4ZWQgei0zMCBiZy1zbGF0ZS04MDAgYm9yZGVyIGJvcmRlci1zbGF0ZS03MDAgcm91bmRlZC1sZyBzaGFkb3cteGwgb3ZlcmZsb3ctdmlzaWJsZSB3LTQ4XCJcbiAgICAgIHN0eWxlPXt7XG4gICAgICAgIHRvcDogcG9zaXRpb24udG9wLFxuICAgICAgICBsZWZ0OiBwb3NpdGlvbi5sZWZ0LFxuICAgICAgICBwb3NpdGlvbjogJ2ZpeGVkJyAvLyBWaWV3cG9ydCByZWxhdGl2ZVxuICAgICAgfX1cbiAgICAgIG9uQ2xpY2s9eyhlKSA9PiBlLnN0b3BQcm9wYWdhdGlvbigpfVxuICAgID5cbiAgICAgIHtvcHRpb25zLm1hcCgob3B0aW9uLCBpbmRleCkgPT4gKFxuICAgICAgICA8YnV0dG9uXG4gICAgICAgICAga2V5PXtpbmRleH1cbiAgICAgICAgICBvbkNsaWNrPXsoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGlmICghb3B0aW9uLmRpc2FibGVkKSB7XG4gICAgICAgICAgICAgIGhhbmRsZU9wdGlvbkNsaWNrKG9wdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfX1cbiAgICAgICAgICBkaXNhYmxlZD17b3B0aW9uLmRpc2FibGVkfVxuICAgICAgICAgIGNsYXNzTmFtZT17YHctZnVsbCB0ZXh0LWxlZnQgcHgtNCBweS0yLjUgdGV4dC1zbSB0cmFuc2l0aW9uLWNvbG9ycyByZWxhdGl2ZSAke29wdGlvbi5kaXNhYmxlZFxuICAgICAgICAgICAgPyAnb3BhY2l0eS01MCBjdXJzb3Itbm90LWFsbG93ZWQgdGV4dC1zbGF0ZS01MDAnXG4gICAgICAgICAgICA6IG9wdGlvbi5kYW5nZXJcbiAgICAgICAgICAgICAgPyAndGV4dC1yZWQtNDAwIGhvdmVyOmJnLXJlZC01MDAvMTAgaG92ZXI6dGV4dC1yZWQtMzAwJ1xuICAgICAgICAgICAgICA6ICd0ZXh0LXdoaXRlIGhvdmVyOmJnLXNsYXRlLTcwMCdcbiAgICAgICAgICAgIH0gJHtpbmRleCA9PT0gMCA/ICcnIDogJ2JvcmRlci10IGJvcmRlci1zbGF0ZS03MDAnfWB9XG4gICAgICAgID5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBnYXAtM1wiPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtM1wiPlxuICAgICAgICAgICAgICB7b3B0aW9uLmljb24gJiYgKFxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImZsZXgtc2hyaW5rLTBcIj57b3B0aW9uLmljb259PC9zcGFuPlxuICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICA8c3Bhbj57b3B0aW9uLmxhYmVsfTwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAge29wdGlvbi5zdWJtZW51ICYmIChcbiAgICAgICAgICAgICAgPHN2ZyBjbGFzc05hbWU9XCJ3LTQgaC00XCIgZmlsbD1cIm5vbmVcIiBzdHJva2U9XCJjdXJyZW50Q29sb3JcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCI+XG4gICAgICAgICAgICAgICAgPHBhdGggc3Ryb2tlTGluZWNhcD1cInJvdW5kXCIgc3Ryb2tlTGluZWpvaW49XCJyb3VuZFwiIHN0cm9rZVdpZHRoPXsyfSBkPVwiTTkgNWw3IDctNyA3XCIgLz5cbiAgICAgICAgICAgICAgPC9zdmc+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgICkpfVxuXG4gICAgICB7LyogU3VibWVudSBPdmVybGF5ICovfVxuICAgICAge2FjdGl2ZVN1Ym1lbnUgJiYgc3VibWVudU9wdGlvbnNbYWN0aXZlU3VibWVudV0gJiYgKFxuICAgICAgICA8ZGl2XG4gICAgICAgICAgY2xhc3NOYW1lPVwiYWJzb2x1dGUgaW5zZXQtMCBiZy1zbGF0ZS04MDAgei0xMCBmbGV4IGZsZXgtY29sIGFuaW1hdGUtaW4gc2xpZGUtaW4tZnJvbS1yaWdodCBkdXJhdGlvbi0yMDBcIlxuICAgICAgICA+XG4gICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4gc2V0QWN0aXZlU3VibWVudShudWxsKX1cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cInctZnVsbCB0ZXh0LWxlZnQgcHgtNCBweS0yLjUgdGV4dC1zbSB0ZXh0LXNsYXRlLTQwMCBob3ZlcjpiZy1zbGF0ZS03MDAgYm9yZGVyLWIgYm9yZGVyLXNsYXRlLTcwMCBmbGV4LXNocmluay0wXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIGdhcC0zXCI+XG4gICAgICAgICAgICAgIDxzdmcgY2xhc3NOYW1lPVwidy00IGgtNFwiIGZpbGw9XCJub25lXCIgc3Ryb2tlPVwiY3VycmVudENvbG9yXCIgdmlld0JveD1cIjAgMCAyNCAyNFwiPlxuICAgICAgICAgICAgICAgIDxwYXRoIHN0cm9rZUxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZUxpbmVqb2luPVwicm91bmRcIiBzdHJva2VXaWR0aD17Mn0gZD1cIk0xNSAxOWwtNy03IDctN1wiIC8+XG4gICAgICAgICAgICAgIDwvc3ZnPlxuICAgICAgICAgICAgICA8c3Bhbj5CYWNrPC9zcGFuPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4LTEgb3ZlcmZsb3cteS1hdXRvXCI+XG4gICAgICAgICAgICB7c3VibWVudU9wdGlvbnNbYWN0aXZlU3VibWVudV0ubWFwKChzdWJtZW51T3B0aW9uLCBpbmRleCkgPT4gKFxuICAgICAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAgICAga2V5PXtpbmRleH1cbiAgICAgICAgICAgICAgICBvbkNsaWNrPXsoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgIGlmICghc3VibWVudU9wdGlvbi5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVTdWJtZW51T3B0aW9uQ2xpY2soYWN0aXZlU3VibWVudSwgc3VibWVudU9wdGlvbik7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICBkaXNhYmxlZD17c3VibWVudU9wdGlvbi5kaXNhYmxlZH1cbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2B3LWZ1bGwgdGV4dC1sZWZ0IHB4LTQgcHktMi41IHRleHQtc20gdHJhbnNpdGlvbi1jb2xvcnMgJHtzdWJtZW51T3B0aW9uLmRpc2FibGVkXG4gICAgICAgICAgICAgICAgICA/ICdvcGFjaXR5LTUwIGN1cnNvci1ub3QtYWxsb3dlZCB0ZXh0LXNsYXRlLTUwMCdcbiAgICAgICAgICAgICAgICAgIDogc3VibWVudU9wdGlvbi5kYW5nZXJcbiAgICAgICAgICAgICAgICAgICAgPyAndGV4dC1yZWQtNDAwIGhvdmVyOmJnLXJlZC01MDAvMTAgaG92ZXI6dGV4dC1yZWQtMzAwJ1xuICAgICAgICAgICAgICAgICAgICA6ICd0ZXh0LXdoaXRlIGhvdmVyOmJnLXNsYXRlLTcwMCdcbiAgICAgICAgICAgICAgICAgIH0gJHtpbmRleCA9PT0gMCA/ICcnIDogJ2JvcmRlci10IGJvcmRlci1zbGF0ZS03MDAnfWB9XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIGdhcC0zXCI+XG4gICAgICAgICAgICAgICAgICB7c3VibWVudU9wdGlvbi5pY29uICYmIChcbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZmxleC1zaHJpbmstMFwiPntzdWJtZW51T3B0aW9uLmljb259PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICAgIDxzcGFuPntzdWJtZW51T3B0aW9uLmxhYmVsfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICApKX1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICApfVxuICAgIDwvZGl2PixcbiAgICBkb2N1bWVudC5ib2R5XG4gICk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBDYXJkTWVudTtcblxuIl0sImZpbGUiOiJDOi9Qcm9qZWN0cy95dHR2Mi9zcmMvY29tcG9uZW50cy9DYXJkTWVudS5qc3gifQ==